# データ整備・提供の手引き

# 1. 整備方針を決める
## 整備対象
### 対象事業者・路線
* 都道府県等が整備主体となる場合、どのバス事業者、自治体を整備対象とするか検討します。
* コミュニティバス等の自治体と民間事業者が協力して運行している場合、自治体と民間事業者のどちらがデータを整備するか明確にします。
* 民間事業者が整備しているデータの中に、コミュニティバス等が含まれている場合があるので留意してください。
* 共同運行路線の場合、 全事業者のデータが揃うかどうか、揃わない場合の対応方針について確認します。
### 動的データ
* バスロケーションシステムを導入している場合、動的データ(GTFS Realtime)も整備対象とするか検討します。
* 動的データは静的データ(GTFS-JP)と組み合わせて利用するため、静的データの整備も必要です。
## 提供先
### オープンデータ
* オープンデータとして配信するかどうかを検討します。
* オープンデータとして配信することで、幅広いサービスにデータが利用されることに加え、利用者との連絡や契約が簡易になる可能性があります。
* 公開済のオープンデータは「[GTFS・「標準的なバス情報フォーマット」オープンデータ一覧](http://tshimada291.sakura.ne.jp/transport/gtfs-list.html)」(旭川高等専門学校  嶋田鉄兵助教 提供)から確認することができます。
### 経路検索事業者
* どの経路検索事業者に提供するか検討します。
* 提供先は多いほど望ましいですが、各社基準によるデータの検証などに時間がかかる可能性があります。
* 掲載済のバス事業者であっても、標準的なバス情報フォーマットに基づいて提供することで、リアルタイム情報への対応や、データの精度・鮮度向上が可能になる場合があります。
* 掲載済バス事業者の一覧は、下記URLから確認が可能です。
  * ヴァル研究所：https://ekiworld.net/service/spec/info.html
  * 駅探：https://bus.ekitan.com/rosen/index.shtml
  * ジョルダン：https://www.jorudan.co.jp/bus/rosen/
  * Google：https://maps.google.com/landing/transit/cities/
    * コミュニティバス等について記載されていないことに留意
  * ナビタイムジャパン：https://www.navitime.co.jp/serviceinfo/buscompanylist/

## 整備方法（システム・委託）

データ整備方法は大別して次の3つの方法が一般的です。

1. 導入済みシステムからの出力
2. 無償ツールを用いた自力整備
3. データ作成代行業者への委託

システムの導入状況や、バス事業者や自治体の人員や技術の状況によって選択してください。

その他、テキストエディタ等を用いた簡易なデータ作成や、独自ツールによる作成を行っても構いません。

### 1. 導入済みシステムからの出力

ダイヤ編成支援システムやバスロケーションシステムを導入済または導入予定の場合、それらのシステムからデータを出力するのがスムーズです。対応状況については、システム提供会社にお問い合わせください。

#### 1-1. ダイヤ編成支援システム

静的データ（GTFS-JP）の出力に対応したシステムがあります。

#### 1-2. バスロケーションシステム

動的データ（GTFS-RT）の出力に対応したシステムがあります。静的データ（GTFS-JP）も併せて出力できる場合もあります。

#### システムから出力時の留意点

* **対応項目**：「標準的なバス情報フォーマット(GTFS / GTFS-JP / GTFS Realtime)対応」を謳っているシステムも、その対応項目はまちまちです。出力に対応していない場合や、新たなデータ整備が必要になる場合があります。本解説ページの[データ整備事例](examples.md)や、各社の製品情報や問い合わせ結果を参考にしてください。
* **運賃**：ダイヤ編成システム、バスロケーションシステム共に扱っていない場合が多くあります。
* **バス停緯度・経度**：ダイヤ編成支援システムによっては、扱っていない場合があります。
* **運行日**：ダイヤ編成支援システムによっては、「平日」「土休日」等の運行パターンのみを管理しており、該当する日付が不明な場合があります。
* **データ同期**：静的データをダイヤ編成支援システムから出力し、動的データをバスロケーションシステムから出力する場合、IDの整合が取れること、ダイヤ改正時に同期できることなどを確認してください。
* **有償オプション**：標準的なバス情報フォーマットの出力機能は、有償のオプションとなっている場合があります。

### 2. 無償ツールを用いた自力整備

国内で開発された無償ツールとしては下記のものが利用可能です。初期データ作成を代行する業者もあります。

#### 2-1. その筋屋

無償版としても提供されるダイヤ編成支援システムです。仕業編成、帳票出力等の機能を持っており、バス運行業務全般をIT化する場合に向いています。ダイヤ編成機能のみを利用することもできます。

- 提供者：Sujiya Systems
- URL：http://www.sinjidai.com/sujiya/

#### 2-2. 標準的なバス情報フォーマット出力ツール（西沢ツール）

Excelマクロを利用したツールです。GTFS-JPデータの作成に特化しているため、比較的簡易に導入できます。

- 提供者：東京大学空間情報科学研究センター 西沢明 特任教授
- URL：https://home.csis.u-tokyo.ac.jp/~nishizawa/gtfs/

#### 2-3. 見える化共通入力フォーマット

Excelマクロを利用したツールです。西沢ツールと類似した特徴があります。

- 提供者：三重県地域連携部交通政策課
- URL：http://www.pref.mie.lg.jp.cache.yimg.jp/KOTSU/HP/m0009200004.htm  (入手には要問い合わせ) 

### 3. データ作成代行業者への委託

#### 3-1. 経路検索事業者への委託

自社の経路検索サービスへの取込だけでなく、標準的なバス情報フォーマットに基づくデータ提供や、Google Maps等への掲載を代行している経路検索事業者があります。

#### 3-2. IT企業等への委託

経路検索事業者以外にも、標準的なバス情報フォーマット、またはGTFSデータの整備を行っている企業があります。

### 参考情報

* 提供実績
  * 解説ページの[データ整備事例](examples.md)をご覧ください。
* 九州運輸局「標準的なバス情報フォーマット作成方法検討マニュアル」
  * データ整備方法の選択、委託、運用にあたっての留意点等について詳しく記載されています。
  * http://wwwtb.mlit.go.jp/kyushu/m_koukatsu.html



# 3. 作成

## 仕様書・解説書

下記の文書を参考に、データを作成、またはデータ作成ツールの開発を行ってください。

* 静的データ
  * 国土交通省「GTFS-JP（標準的なバス情報フォーマット　静的データ）解説書」
  * Google Developers「静的なGTFSの概要」
    * https://developers.google.com/transit/gtfs/?hl=ja

* 動的データ
  * 国土交通省「[GTFS Realtime（標準的なバス情報フォーマット　動的データ）解説書](gtfs-realtime.md)」
  * Google Developers「GTFSリアルタイムとは」
    * https://developers.google.com/transit/gtfs-realtime/?hl=ja

## データ収集

### 静的データのための情報収集

静的データ(GTFS-JP)の作成には下記の情報が必要です。

既存システムへのデータ追加投入、自力データ整備、外部委託いずれにおいても、必要な情報を収集・作成する必要があります。「主な情報源」に記載した資料などからデータを作成してください。

| 対象         | ファイル(.txt)                  | 必須 | 主な情報                             | 主な情報源                           |
| ------------ | ------------------------------- | ---- | ------------------------------------ | ------------------------------------ |
| 停留所       | stops                           | 必須 | 名称、標柱（のりば）の緯度・経度     | GIS登録データ、地理院地図、実測      |
| 経路（系統） | routes                          | 必須 | 経路（系統）名称                     | 路線時刻表、運行計画概要書           |
| 時刻表       | trips<br />stop_times           | 必須 | 便ごとの発着時刻                     | 路線時刻表                           |
| 運行日       | calendar<br />calendar_dates    | 必須 | 運行曜日、運行・運休日               | 運行計画概要書                       |
| 運賃         | fare_attributes<br />fare_rules | 必須 | 停留所間の運賃                       | 三角表                               |
| 描画情報     | shapes                          | 任意 | 通過経路の緯度・経度                 | バスマップ、路線図、地理院地図、実測 |
| 翻訳情報     | translations                    | 必須 | よみがな（必須）、外国語表記（任意） | 車内アナウンス原稿                   |

* 

### 動的データ(GTFS Realtime)への変換・入力

| 対象       | 要素            | 設定可能な主な情報                                      |
| ---------- | --------------- | ------------------------------------------------------- |
| 時刻の更新 | TripUpdate      | 遅延、発着時刻予測                                      |
| 位置情報   | VehiclePosition | 車両の緯度・経度、接近情報、混雑度                      |
| 運行情報   | Alert           | 見出し、影響（運休、迂回等）、原因（天候、事故等）、URL |

既存のデータが無い場合、

### 停留所

* 主な情報
  * 名称、よみがな、多言語表記、標柱（のりば）の緯度・経度
* 作成にあたっての留意点
  * のりば
  * 多言語表記
  * 地理院地図

### 経路（系統）

* 主な情報
  * 経路（系統）名称
* 作成にあたっての留意点
  * 補助金や運行計画の申請に用いている系統一覧が参考になります。
  * 経路の区切り方

### 時刻表

- 主な情報
  - 便毎の発着時刻
- 作成にあたっての留意点
  - バス停に掲示されている発時刻表ではなく、便毎の通過時刻表（Ａ停留所 10:00発 → Ｂ停留所 10:03発 → Ｃ停留所 10:05発…というような時刻表）を元に作成します。

### 運賃

- 主な情報
  - 全停留所間の運賃
- 作成にあたっての留意点
  - 経路の区切り方

## 

# 4. データ検証

### 静的データの検証ツール

* Feed Validator
  * Webサービス
  * オープンソース
* Google Transit
* 各種ビューア

### 動的データの検証ツール

* gtfs-realtime-validator
  * ※サーバ立てるかも
* 各種Protocol Buffers ビューア

# 5. 提供

## データ配信
## 経路検索コンテンツプロバイダへの提供

# 6. 更新

## ダイヤ改正

## 担当者引き継ぎ

# 困ったときは

## 事例探し

## コミュニティ

* discuss@gtfs.jp
* FBグループ作る？
* GitHub Issues 稼働させる？